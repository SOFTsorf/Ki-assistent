<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NEXUS AI</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#0b0b0c;color:#e8e8e8}
#chat-area{padding:90px 20px 200px;overflow-y:auto;height:100vh;box-sizing:border-box}
.bubble-container{max-width:85%;margin-bottom:12px}
.user-container{margin-left:auto}
.ai-container{margin-right:auto}
.bubble{padding:12px 18px;border-radius:18px}
.user{background:#007aff;color:#fff}
.ai{background:#18191b;border:1px solid rgba(255,255,255,.1)}
.footer{position:fixed;bottom:20px;width:100%;display:flex;justify-content:center}
input{width:90%;padding:14px;border-radius:30px;border:none;font-size:16px}
#typing{color:#00ff88;font-size:13px;margin-bottom:10px}
</style>
</head>

<body>

<div id="chat-area"></div>

<div class="footer">
<input id="input-field" placeholder="Frage etwas...">
</div>

<script>
/* ==========================
   CONFIG
========================== */
const API_KEY = "SECRET_GROQ_KEY_PLACEHOLDER";

/* ==========================
   STATE
========================== */
let chatHistory = [{role:"system",content:"Antworte kurz auf Deutsch."}];

/* ==========================
   INIT
========================== */
init();

function init(){
    startNewChat();
}

/* ==========================
   CHAT
========================== */
function startNewChat(){
    chatHistory = [{role:"system",content:"Antworte kurz auf Deutsch."}];
    renderDashboard();
}

function renderDashboard(){
    const area = document.getElementById("chat-area");
    area.innerHTML = `
        <div style="font-size:28px;font-weight:800;margin-bottom:30px">
            Willkommen bei NEXUS
        </div>
    `;

    const typing = document.createElement("div");
    typing.id = "typing";
    typing.style.display = "none";
    typing.innerText = "NEXUS AI denkt nach...";
    area.appendChild(typing);
}

/* ==========================
   SEND
========================== */
document.getElementById("input-field").addEventListener("keypress",e=>{
    if(e.key==="Enter" && e.target.value){
        const text = e.target.value;
        e.target.value="";
        addBubble(text,"user");
        askAI(text);
    }
});

/* ==========================
   AI
========================== */
async function askAI(text){
    const typing = document.getElementById("typing");
    if(typing) typing.style.display="block";

    chatHistory.push({role:"user",content:text});

    try{
        const res = await fetch("https://api.groq.com/openai/v1/chat/completions",{
            method:"POST",
            headers:{
                "Authorization":"Bearer "+API_KEY,
                "Content-Type":"application/json"
            },
            body:JSON.stringify({
                model:"llama-3.3-70b-versatile",
                messages:chatHistory.slice(-10)
            })
        });

        if(!res.ok) throw new Error("HTTP "+res.status);

        const data = await res.json();
        const ans = data.choices?.[0]?.message?.content;

        if(!ans){
            addBubble("⚠️ Leere Antwort vom Modell","ai");
            return;
        }

        chatHistory.push({role:"assistant",content:ans});
        addBubble(ans,"ai");

    }catch(e){
        console.error("AI ERROR:",e);
        addBubble("⚠️ API Fehler – siehe Konsole","ai");
    }finally{
        if(typing) typing.style.display="none";
    }
}

/* ==========================
   UI
========================== */
function addBubble(text,side){
    const area = document.getElementById("chat-area");
    const cont = document.createElement("div");
    cont.className = `bubble-container ${side}-container`;

    const html = side==="ai" ? marked.parse(text) : text;
    cont.innerHTML = `<div class="bubble ${side}">${html}</div>`;

    const typing = document.getElementById("typing");
    area.insertBefore(cont, typing);
    area.scrollTop = area.scrollHeight;
}
</script>

</body>
</html>
